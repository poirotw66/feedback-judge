# 身心障礙手冊AI測試結果準確度評分系統

## 專案概述

這是一個專門用於評估AI模型在身心障礙手冊資料處理準確度的Python程式系統。系統能夠自動讀取Excel檔案，比較人工標註（正面）與AI預測（反面）的結果，並生成詳細的準確度報告。

## 主要功能

✅ **智能Excel解析**: 自動偵測複雜的Excel檔案結構和標題行位置  
✅ **多欄位評估**: 支援障礙等級、障礙類別、ICD診斷等多個欄位的準確度評估  
✅ **相似度分析**: 不僅計算完全匹配，還提供字串相似度分析  
✅ **詳細報告**: 生成包含錯誤分析的詳細Excel報告  
✅ **權重配置**: 可自訂各欄位的評估權重  

## 系統架構

```
feedback-judge/
├── accuracy_evaluator.py    # 核心評估引擎
├── smart_processor.py      # 智能Excel處理器（推薦使用）
├── excel_processor.py      # 通用Excel處理器
├── main.py                # 基本範例程式
├── usage_guide.py         # 使用說明程式
└── README.md              # 本檔案
```

## 快速開始

### 1. 環境設定

```bash
# 使用conda環境（如您指定的crawl4ai）
conda activate crawl4ai

# 或使用虛擬環境
python -m venv .venv
source .venv/bin/activate  # macOS/Linux
# 或 .venv\Scripts\activate  # Windows

# 安裝必要套件
pip install pandas numpy openpyxl
```

### 2. 準備資料

確保您的Excel檔案包含以下格式的資料：

| 編號 | 受編 | 障礙等級 | 障礙類別 | ICD診斷 | ... | 障礙等級(AI) | 障礙類別(AI) | ICD診斷(AI) |
|------|------|----------|----------|---------|-----|--------------|--------------|-------------|
| 1    | ZA... | 輕度     | 其他類   | 【換16.1】| ... | 輕度         | 其他類       | 【換16.1】  |

### 3. 執行評估

```bash
# 使用智能處理器（推薦）
python smart_processor.py

# 或使用基本處理器
python main.py
```

## 評估結果

### 實際測試結果（基於您的資料）

**整體準確度: 85.30%**

| 欄位 | 準確度 | 完全匹配率 | 說明 |
|------|--------|------------|------|
| 障礙類別 | 99.58% | 86.7% | 表現優秀，大部分都能正確識別 |
| ICD診斷 | 68.17% | 42.9% | 需要改進，部分項目識別困難 |

### 主要問題分析

1. **ICD診斷欄位**: 
   - 某些複雜格式無法正確識別
   - 建議加強訓練資料中的醫學診斷代碼樣本

2. **影像品質影響**:
   - 浮水印和雜訊會影響識別準確度
   - 建議預處理改善影像品質

## 系統特色

### 1. 智能欄位識別
- 自動偵測Excel檔案的標題行位置
- 智能映射正面（標準答案）和反面（AI預測）欄位
- 支援複雜的多級標題結構

### 2. 多層次評估
- **完全匹配**: 計算完全相同的項目
- **相似度評估**: 使用序列匹配算法
- **加權評估**: 根據欄位重要性調整權重

### 3. 詳細錯誤分析
- 列出所有不匹配的項目
- 提供相似度分數
- 識別常見錯誤模式

## 配置選項

在 `accuracy_evaluator.py` 中可調整：

```python
# 相似度閾值
similarity_threshold = 0.8

# 欄位權重設定
weight_config = {
    FieldType.DISABILITY_LEVEL: 0.3,    # 障礙等級
    FieldType.DISABILITY_CATEGORY: 0.3,  # 障礙類別  
    FieldType.ICD_DIAGNOSIS: 0.25,      # ICD診斷
    FieldType.CERTIFICATE_TYPE: 0.15    # 證明/手冊類型
}
```

## 輸出檔案

系統會生成以下檔案：

1. **智能評估結果_[檔案名].xlsx**: 包含詳細分析的Excel報告
   - 摘要頁：各欄位準確度統計
   - 錯誤詳情頁：不匹配項目的詳細列表

2. **終端報告**: 即時顯示的評估摘要

## 使用建議

### 資料準備
- 確保Excel檔案格式一致
- 清理不必要的空白和特殊字符
- 標準化診斷代碼格式

### 參數調整
- 根據實際需求調整相似度閾值
- 針對特定應用場景調整欄位權重
- 定期更新文字標準化規則

### 結果驗證
- 結合人工檢查驗證自動評估結果
- 定期分析錯誤模式並改進
- 建立評估基準線進行比較

## 技術支援

如遇到問題，請檢查：

1. **檔案格式**: 確保Excel檔案可正常開啟
2. **Python環境**: 確認已安裝必要套件
3. **資料品質**: 檢查是否有缺失或格式錯誤的資料

## 版本資訊

- **當前版本**: 1.0.0
- **Python版本**: 3.8+
- **主要依賴**: pandas, numpy, openpyxl
- **測試環境**: macOS, Python 3.12

## 授權

本專案基於MIT授權協議開源。

---

*最後更新: 2025年8月6日*
