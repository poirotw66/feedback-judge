# 使用者指南：身心障礙手冊AI測試結果準確度評分系統

## 🎯 概述

這個FastAPI應用程式現在支援**智能欄位偵測**，可以自動識別您的Excel檔案格式，無需修改欄位名稱。

## 📊 支援的資料格式

### 您的資料格式（已支援）
```
編號 | 受編 | 障礙等級 | 障礙類別 | ICD診斷 | 備註 | 障礙等級 | 證明/手冊 | 障礙類別 | ICD診斷
-----|------|----------|----------|---------|------|----------|----------|----------|----------
 1   | ZA.. | 輕度     | 其他類   | 【換..】|      | 輕度     | 身心..   | 障礙類別..| 【換..】
 2   | MT.. | 中度     | 第1類..  | 【換..】|      | 中度     | 身心..   | 第1類..  | 【第..】
```

### 系統如何識別您的資料

1. **智能欄位偵測**：
   - 自動偵測重複的欄位名稱（如：障礙等級、障礙類別、ICD診斷）
   - 根據位置判斷：前面的是正確答案，後面的是AI預測

2. **位置基礎映射**：
   - 第3欄（障礙等級）→ 正確答案
   - 第4欄（障礙類別）→ 正確答案  
   - 第5欄（ICD診斷）→ 正確答案
   - 第7欄（障礙等級）→ AI預測
   - 第9欄（障礙類別）→ AI預測
   - 第10欄（ICD診斷）→ AI預測

3. **內容驗證**：
   - 檢查欄位內容是否包含相關關鍵字
   - 障礙等級：輕度、中度、重度、極重度
   - 障礙類別：類、其他、第1類、第2類等
   - ICD診斷：【、】、換、第等符號

## 🚀 使用方式

### 1. 啟動API服務
```bash
python start_api.py
```

### 2. 上傳您的Excel檔案

#### 使用curl命令
```bash
curl -X POST "http://localhost:8000/evaluate" \
     -F "file=@your_data.xlsx" \
     --output result.xlsx
```

#### 使用Python
```python
import requests

url = "http://localhost:8000/evaluate"
files = {"file": open("your_data.xlsx", "rb")}

response = requests.post(url, files=files)

if response.status_code == 200:
    with open("result.xlsx", "wb") as f:
        f.write(response.content)
    print("評估完成！")
else:
    print(f"錯誤: {response.json()}")
```

#### 使用網頁介面
訪問 http://localhost:8000/docs 使用Swagger UI介面上傳檔案

### 3. 檢視結果

生成的Excel檔案包含7個工作表：

1. **評估摘要** - 整體統計和各欄位準確度
2. **記錄摘要** - 每筆記錄的準確度摘要
3. **詳細欄位比較** - 逐欄位的詳細比較結果
4. **欄位統計** - 各欄位的統計分析
5. **錯誤分析** - 錯誤類型分析和改進建議
6. **原始資料** - 上傳的原始資料
7. **準確度分佈** - 準確度等級分佈統計

## 📋 資料要求

### 必要欄位
- **編號**：記錄編號
- **受編**：受測者編號
- **障礙等級**（兩欄）：正確答案 + AI預測
- **障礙類別**（兩欄）：正確答案 + AI預測
- **ICD診斷**（兩欄）：正確答案 + AI預測

### 檔案格式
- 支援：`.xlsx`、`.xls`
- 大小限制：10MB
- 編碼：UTF-8

## 🔧 智能偵測功能

### 自動欄位映射
系統會自動：
1. 偵測Excel檔案中的欄位名稱
2. 識別重複的欄位（障礙等級、障礙類別、ICD診斷）
3. 根據位置判斷正確答案和AI預測
4. 驗證欄位內容是否符合預期

### 錯誤處理
如果自動偵測失敗，系統會：
1. 提供詳細的錯誤訊息
2. 列出可用的欄位名稱
3. 建議正確的資料格式

## 📊 評估指標

### 準確度計算
- **完全匹配**：文字完全相同
- **相似度評估**：使用序列匹配算法（0-1分數）
- **加權評估**：
  - 障礙等級：30%
  - 障礙類別：30%
  - ICD診斷：25%
  - 證明/手冊：15%

### 結果分類
- **優秀**：90-100%
- **良好**：70-90%
- **普通**：50-70%
- **需改進**：0-50%

## 🛠️ 故障排除

### 常見問題

1. **欄位偵測失敗**
   - 確保Excel檔案包含必要的欄位名稱
   - 檢查是否有重複的欄位（障礙等級、障礙類別、ICD診斷）
   - 確認資料格式符合預期

2. **檔案上傳失敗**
   - 檢查檔案格式（必須是.xlsx或.xls）
   - 確認檔案大小不超過10MB
   - 檢查檔案是否損壞

3. **評估結果異常**
   - 檢查資料內容是否包含預期的關鍵字
   - 確認正確答案和AI預測的欄位位置
   - 檢查是否有空值或格式問題

### 日誌檢查
API會記錄詳細的處理過程：
```
INFO:evaluator_service:偵測到的欄位: ['編號', '受編', '障礙等級', ...]
INFO:evaluator_service:智能映射成功: {'障礙等級': ('障礙等級', '障礙等級'), ...}
INFO:evaluator_service:評估完成，處理時間: 0.26秒
```

## 📞 技術支援

如果遇到問題：
1. 檢查API日誌輸出
2. 確認資料格式符合要求
3. 使用測試檔案驗證系統功能
4. 聯繫技術支援團隊

## 🎉 成功案例

您的資料格式已經成功測試：
- ✅ 智能欄位偵測正常運作
- ✅ 準確度評估計算正確
- ✅ Excel結果檔案生成成功
- ✅ 所有測試案例通過

現在您可以直接使用現有的Excel檔案格式，無需任何修改！
